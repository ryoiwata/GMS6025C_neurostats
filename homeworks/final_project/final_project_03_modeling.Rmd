---
title: "Final Project"
author: "Emely Gazarov, Ryo Iwata, Maria Ramirez"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidymodels)
library(knitr)
library(car)
# install.packages("ggalluvial")
library(ggalluvial)
# install.packages("circlize")
library(circlize)
library(stringr)
# install.packages("cowplot")
library(cowplot)
# install.packages("ggpie")
library(ggpie)
# to control default number formatting, no need for specifying digits in kable.
# install.packages("ggheatmap")
library(ggheatmap)
# install.packages("ggcorrplot")
library(ggcorrplot)

options(scipen = 3, digits = 5) 
```

```{r}
cleaned_addiction_data = read_rds("./addiction.rds") |>
  mutate(commit_change = commit.DC - commit.BL)

```

```{r}
cleaned_addiction_data 
```

# Overview of what we're working with

### Things that can predict
- number of sober days
- days since baseline
- age
- gender
- education
- drop out yes no
- SUD is alcholoc
- SUD is other
- Social support
  - family
  - friends
  - sig other
  - total
- Substance use history
  - Tried tobacco/alcohol
  - Age of first use
  - Regular use
  - Age of regular use
- AA/NA affiliation
  - Lifetime number of meetings
  - Last year number of meetings
  - Degree of affiliation
  - Positive thoughts
  - Negative thoughts
- Stressful life
  - happened
  - witnessed
  - learned about
  - exposed
  - total of all things
- Childhood
- Religion
  - Religious affiliation
  - Positive
  - Negative
- Life quality

### Things we can predict
- impression change
- length of stay
- Life quality
- Commitment to change
- Cravings
  - baseline
  - baseline vs followup
- Impression of change

# Looking at the basic demographics

# Change Commitment model

```{r}
commit_model <- lm(commit_change ~ 
                + age 
                + gender
                + education
                + rel.is_religious
                + religion_pos
                + religion_neg
                + aana_past_year
                + SUD.sum_illegal
                + SUD.sum_legal
                ,cleaned_addiction_data)
```

```{r}
kable(tidy(commit_model))
```

```{r}
car::Anova(commit_model)
```


```{r}
abstain_model = lm(abstain_total.BL ~
                             + age 
                             + gender
                             + education
                             # + treatment_days
                             + SUD.sum_illegal
                             + SUD.sum_legal
                             # + aana_positive
                             + childhood_sum
                             # + commit.BL
                             + social
                             + religion_pos
                             + rel.is_religious 
                   
                             # + religion_neg
                             + stress_to_subj
                             + stress_wit,
                             cleaned_addiction_data)
```
```{r}
car::Anova(abstain_model)

```

```{r}
cleaned_addiction_data |>
  ggplot(aes(education, abstain_total.BL, color=education)) +
  geom_violin() +
  geom_jitter(height = 0, width = 0.1) +
  # geom_count() +
  stat_summary(fun = "mean",
             geom = "crossbar",
             color = "red") +
  # geom_boxplot(width=0.1) +
  labs(title = "Education and confidence to abstain") +
  # facet_wrap(vars(SUD.uses_illegal)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=10))

  
```

```{r}
cleaned_addiction_data |>
  ggplot(aes(age, abstain_total.BL, color=education)) +
  geom_jitter() +
  # scale_x_continuous(n.breaks=20) +
  # scale_y_continuous(n.breaks=20) +
  labs(title = "Abstain confidence baseline to discharge") +
  facet_wrap(vars(education))
  
```

```{r}
cleaned_addiction_data |>
  ggplot(aes(religion_pos, abstain_total.BL, color=rel.is_religious)) +
  geom_jitter() +
  # scale_x_continuous(n.breaks=20) +
  # scale_y_continuous(n.breaks=20) +
  labs(title = "Abstain confidence baseline to discharge") +
  facet_wrap(vars(rel.is_religious))
  
```
```{r}
craving_model = lm(craving.BL ~
                             + age 
                             + gender
                             + education
                             # + treatment_days
                             + SUD.sum_illegal
                             + SUD.sum_legal
                             # + aana_positive
                             # + childhood_sum
                             # + commit.BL
                             + social
                             + religion_pos
                             + rel.is_religious
                              # + aana_life 
                   + aana_past_year
                   + aana_positive
                   
                             # + religion_neg
                             + stress_to_subj
                             # + stress_wit,
                   ,
                             cleaned_addiction_data)
```
```{r}
car::Anova(craving_model)

```


```{r}
qol_model = lm(qol.BL ~
                          + age 
                             + gender
                             + education
                             # + treatment_days
                             + SUD.sum_illegal
                             + SUD.sum_legal
                             # + aana_positive
                             # + childhood_sum
                             # + commit.BL
                             + social
                             + religion_pos
                             + rel.is_religious 
                   
                             # + religion_neg
                             + stress_to_subj
                             # + stress_wit,
                   ,
                             cleaned_addiction_data)
```
```{r}
car::Anova(qol_model)

```
```{r}
cleaned_addiction_data |>
  ggplot(aes(religion_pos, qol.BL, color=rel.is_religious)) +
  geom_jitter() +
  # scale_x_continuous(n.breaks=20) +
  # scale_y_continuous(n.breaks=20) +
  labs(title = "Abstain confidence baseline to discharge") +
  facet_wrap(vars(rel.is_religious))
  
```

```{r}
cleaned_addiction_data |>
  ggplot(aes(social, qol.BL, color=rel.is_religious)) +
  geom_jitter() +
  # scale_x_continuous(n.breaks=20) +
  # scale_y_continuous(n.breaks=20) +
  labs(title = "Abstain confidence baseline to discharge") +
  facet_wrap(vars(rel.is_religious))
  
```


##############################################################
```{r}
blah

                             + age 
                             + gender
                             + education
                             + treatment_days
                             + SUD.sum_illegal
                             + SUD.sum_legal
                             + aana_positive
                             + aana_negative
                             + childhood_sum
                             + commit.BL
                             + abstain_total.BL
                             + qol.BL
                             + social
                             + religion_pos
                             + religion_neg
                             + stress_to_subj
                             + stress_wit
                             + craving.BL,
```
```{r}
age, treatment_days, SUD.sum_illegal, SUD.sum_legal, aana_positive, aana_negative, childhood_sum, commit.BL, abstain_total.BL, qol.BL, social, religion_pos, religion_neg, stress_to_subj, stress_wit, craving.BL
```

```{r}
stress_to_abstain_model = lm(abstain_confidence_neg_mean_baseline ~
                               stressful_life.happened_to_you_total 
                             + age 
                             + gender
                             + education
                             + number_of_sober_days
                             + number_of_days_in_treatment
                             + SUD.sum
                             + social_support.total
                             + aana_affiliation.aaas_total
                             + aana_affiliation.tspe_positive
                             + childhood_total
                             + religion.positive_spiritual_cope
                             + religion.is_religious
                             + SUD.does_illegal_drugs,
                             cleaned_addiction_data)
```

```{r}
car::Anova(stress_to_abstain_model)
```

```{r}
cleaned_addiction_data |> ggplot(aes(x=aana_affiliation.tspe_positive, y=abstain_confidence_neg_mean_baseline, color=SUD.sum)) +
  geom_jitter()
```

```{r}
qol_model = lm(qol.mean_baseline ~
                               stressful_life.happened_to_you_total 
                             + age 
                             + gender
                             + education
                             + number_of_sober_days
                             + number_of_days_in_treatment
                             + SUD.sum
                             + social_support.total
                             + aana_affiliation.aaas_total
                             + aana_affiliation.tspe_positive
                             + childhood_total
                             + religion.positive_spiritual_cope 
               + religion.is_religious 
               +  SUD.does_illegal_drugs, 
                             cleaned_addiction_data)
```

```{r}
car::Anova(qol_model)
```

```{r}
cleaned_addiction_data |> ggplot(aes(x=social_support.total, y=qol.mean_baseline, color=SUD.sum)) +
  geom_jitter()
```

```{r}
duration_model = lm(number_of_days_in_treatment ~
                               stressful_life.happened_to_you_total
                             + age 
                             + gender
                             + education
                             + number_of_sober_days
                             + number_of_days_in_treatment
                             + SUD.sum
                             + social_support.total
                             + aana_affiliation.aaas_total
                             + aana_affiliation.tspe_positive
                             + childhood_total
                             + religion.positive_spiritual_cope
                    + religion.is_religious
                             + SUD.does_illegal_drugs, 
                             cleaned_addiction_data)
```

```{r}
car::Anova(duration_model)
```

```{r}
cleaned_addiction_data |> ggplot(aes(x=number_of_days_in_treatment, color=education,)) +
  geom_density()
```


```{r}
car::Anova(commitment_model)
```

```{r}
stress_to_abstain_model = lm(abstain_confidence_neg_mean_baseline ~
                               stressful_life.happened_to_you_total 
                             + age 
                             + gender
                             + education
                             + number_of_sober_days
                             + number_of_days_in_treatment
                             + SUD.sum
                             + social_support.total
                             + aana_affiliation.aaas_total
                             + aana_affiliation.tspe_positive
                             + childhood_total
                             + religion.positive_spiritual_cope
                             + religion.is_religious
                             + SUD.does_illegal_drugs,
                             cleaned_addiction_data)
```

  + SUD.is_Alchohol
  + SUD.is_Opioid 
  + SUD.is_Cannabis
  + SUD.is_sedative_hypnotic_anxiolytic 
  + SUD.is_Cocaine 
  + SUD.is_Other_stimulant 
  + SUD.is_Hallucinogen 
  + SUD.is_Nicotine 
  + SUD.is_Inhalant 
  + SUD.is_psychoactive 

```{r}
car::Anova(stress_to_abstain_model)
```
